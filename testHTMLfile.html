<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
    <div class="scene">
        <main class="container-fluid d-flex h-100 flex-column">
            <div class="row flex-grow-1" id="UIRow">
                <div class="row flex-grow-1" id="UIRow">
                    <div class="col-4" style="height: 100%; padding: 0px;">
                        <div class="menuCol">
                            <h1 class="navbarTitle">DeskSpacing</h1>
                            <p class="underTitleText">Created by Cooper Lappenbusch and Travers Sorenson &copy;</p>
                            <div class="accordion" id="accordionExample">
                                <div class="card z-depth-0 bordered">
                                    <div class="card-header" id="headingOne" data-toggle="collapse"
                                        data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                        <h5 class="mb-0">
                                            <button class="btn btn-link" type="button">
                                                Desks
                                            </button>
                                        </h5>
                                    </div>
                                    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne"
                                        data-parent="#accordionExample">
                                        <div class="card-body">
                                            <div class="jarvisStandingDesk"
                                                onclick="selectNew3DObject('desk','jarvisStandingDesk',this)">
                                                <div class="productPicture">
                                                    <img class="productPictureImg" width="200px" height="200px"
                                                        src="https://www.fully.com/media/catalog/product/cache/98207abf3b475baeffaf823b5f6edc92/f/u/fully-jarvis-standing-desk-black-bamboo-contour-c-v1.jpg">
                                                </div>
                                                <h3>Default Standing Desk</h3>
                                                <p class="productDescription">Lorem ipsum dolor sit amet, consectetur
                                                    adipiscing
                                                    elit, sed do eiusmod
                                                    tempor
                                                </p>
                                            </div>
                                            <div class="productBarrier"></div>
                                            <div class="drawerDesk"
                                                onclick="selectNew3DObject('desk','drawerDesk',this)">
                                                <div class="productPicture">
                                                    <img class="productPictureImg" width="200px" height="200px"
                                                        src="https://www.fully.com/media/catalog/product/cache/98207abf3b475baeffaf823b5f6edc92/f/u/fully-jarvis-standing-desk-black-bamboo-contour-c-v1.jpg">
                                                </div>
                                                <h3>Drawer Desk</h3>
                                                <p class="productDescription">Lorem ipsum dolor sit amet, consectetur
                                                    adipiscing
                                                    elit, sed do eiusmod
                                                    tempor
                                                </p>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="card z-depth-0 bordered">
                                    <div class="card-header" id="headingTwo" type="button" data-toggle="collapse"
                                        data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        <h5 class="mb-0">
                                            <button class="btn btn-link collapsed">
                                                Monitors
                                            </button>
                                        </h5>
                                    </div>
                                    <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo"
                                        data-parent="#accordionExample">
                                        <div class="card-body">
                                            <div id="default16x9Monitor"
                                                onclick="selectNew3DObject('monitor','default16x9Monitor',this)">
                                                <div class="productPicture">
                                                    <img class="productPictureImg" width="200px" height="200px"
                                                        src="https://www.fully.com/media/catalog/product/cache/98207abf3b475baeffaf823b5f6edc92/f/u/fully-jarvis-standing-desk-black-bamboo-contour-c-v1.jpg">
                                                </div>
                                                <h3>Default 16:9 Monitor</h3>
                                                <p class="productDescription">Lorem ipsum dolor sit amet, consectetur
                                                    adipiscing
                                                    elit, sed do eiusmod
                                                    tempor
                                                </p>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div id="defaultUltrawideMonitor"
                                                onclick="selectNew3DObject('monitor','defaultUltrawideMonitor',this)">
                                                <div class="productPicture">
                                                    <img class="productPictureImg" width="200px" height="200px"
                                                        src="https://www.fully.com/media/catalog/product/cache/98207abf3b475baeffaf823b5f6edc92/f/u/fully-jarvis-standing-desk-black-bamboo-contour-c-v1.jpg">
                                                </div>
                                                <h3>Default 21:9 34" Monitor</h3>
                                                <p class="productDescription">Lorem ipsum dolor sit amet, consectetur
                                                    adipiscing
                                                    elit, sed do eiusmod
                                                    tempor
                                                </p>
                                            </div>
                                        </div>


                                    </div>
                                </div>

                                <div class="card z-depth-0 bordered">
                                    <div class="card-header" id="headingFour" type="button" data-toggle="collapse"
                                        data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                        <h5 class="mb-0">
                                            <button class="btn btn-link collapsed">
                                                Keyboards
                                            </button>
                                        </h5>
                                    </div>
                                    <div id="collapseFour" class="collapse" aria-labelledby="headingFour"
                                        data-parent="#accordionExample">
                                        <div class="card-body">
                                            <div id="default60PercentKeyboard"
                                                onclick="selectNew3DObject('keyboard','default60PercentKeyboard',this)">
                                                <div class="productPicture">
                                                    <img class="productPictureImg" width="200px" height="200px"
                                                        src="https://www.fully.com/media/catalog/product/cache/98207abf3b475baeffaf823b5f6edc92/f/u/fully-jarvis-standing-desk-black-bamboo-contour-c-v1.jpg">
                                                </div>
                                                <h3>Default 60% Keyboard</h3>
                                                <p class="productDescription">
                                                    Lorem ipsum dolor sit amet, consectetur
                                                    adipiscing
                                                    elit, sed do eiusmod
                                                    tempor
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card z-depth-0 bordered">
                                    <div class="card-header" id="headingSix" type="button" data-toggle="collapse"
                                        data-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                                        <h5 class="mb-0">
                                            <button class="btn btn-link collapsed">
                                                Mouse
                                            </button>
                                        </h5>
                                    </div>
                                    <div id="collapseSix" class="collapse" aria-labelledby="headingSix"
                                        data-parent="#accordionExample">
                                        <div class="card-body">
                                            <div id="mediumRGBMousepad"
                                                onclick="selectNew3DObject('mousepad','mediumRGBMousepad',this)">
                                                <div class="productPicture">
                                                    <img class="productPictureImg" width="200px" height="200px"
                                                        src="https://www.fully.com/media/catalog/product/cache/98207abf3b475baeffaf823b5f6edc92/f/u/fully-jarvis-standing-desk-black-bamboo-contour-c-v1.jpg">
                                                </div>
                                                <h3>QCK Medium RGB Mousepad</h3>
                                                <p class="productDescription">
                                                    Lorem ipsum dolor sit amet, consectetur
                                                    adipiscing
                                                    elit, sed do eiusmod
                                                    tempor
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card z-depth-0 bordered">
                                    <div class="card-header" id="headingFive" type="button" data-toggle="collapse"
                                        data-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                        <h5 class="mb-0">
                                            <button class="btn btn-link collapsed">
                                                Mousepads
                                            </button>
                                        </h5>
                                    </div>
                                    <div id="collapseFive" class="collapse" aria-labelledby="headingFive"
                                        data-parent="#accordionExample">
                                        <div class="card-body">
                                            <div id="mediumRGBMousepad"
                                                onclick="selectNew3DObject('mousepad','mediumRGBMousepad',this)">
                                                <div class="productPicture">
                                                    <img class="productPictureImg" width="200px" height="200px"
                                                        src="https://www.fully.com/media/catalog/product/cache/98207abf3b475baeffaf823b5f6edc92/f/u/fully-jarvis-standing-desk-black-bamboo-contour-c-v1.jpg">
                                                </div>
                                                <h3>QCK Medium RGB Mousepad</h3>
                                                <p class="productDescription">
                                                    Lorem ipsum dolor sit amet, consectetur
                                                    adipiscing
                                                    elit, sed do eiusmod
                                                    tempor
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-8" id="rightSideContainer">
                        <canvas id="threeCanvas">
                        </canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>
    </div>
    <script src="three.min.js"></script>
    <script src="OrbitControls.js"></script>
    <!--<script src="./three/examples/jsm/controls/DragControls.js"></script>-->
    <script src="GLTFLoader.js"></script>
    <script src="three/examples/js/controls/DragControls.js"></script>
    <script src="three/examples/js/controls/TransformControls.js"></script>
    <script src="three/examples/js/loaders/DRACOLoader.js"></script>
    <script>
        //import * as THREE from './three';
        var controls, dragControls, transformControls;
        var scene = new THREE.Scene();

        //var dracoLoader = new DRACOLoader();
        //dracoLoader.setDecoderPath('/examples/js/libs/draco/');
        //loader.setDRACOLoader(dracoLoader);
        var myCanvas = document.getElementById("threeCanvas");
        var rightSideContainer = document.getElementById("rightSideContainer");
        var camera = new THREE.PerspectiveCamera(75, myCanvas.clientWidth / myCanvas.clientHeight, 0.1, 1000);
        var renderer = new THREE.WebGLRenderer({ canvas: myCanvas, antialias: true, powerPreference: "high-performance", });

        renderer.setSize(myCanvas.clientWidth, myCanvas.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap; // default THREE.PCFShadowMap
        var loader = new THREE.GLTFLoader();

        renderer.setClearColor(0xffffff, 0); // second param is opacity, 0 => transparent
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        renderer.gammaFactor = 2.2;
        renderer.gammaOutput = true;
        renderer.outputEncoding = THREE.sRGBEncoding;
        //Adding light
        var light = new THREE.AmbientLight(0xFFFFFF);// soft white light
        light.intensity = .7;
        var lampLight = new THREE.PointLight("white", 2, 100);
        lampLight.position.set(30, 45, 49.4);
        scene.add(lampLight);
        scene.add(light);
        //camera.add(light);
        controls.disabled = true;
        controls.enableZoom = true;
        controls.enableRotate = true;
        camera.position.set(33.140910317837964, 61.27639300930197, 21.183811053080007);
        controls.update();
        camera.rotation.set(-0.3618175319112695, -0.012200336135305153, -0.004617427467257444);
        controls.update();
        camera.lookAt(25, 8.5, 35);
        controls.update();
        controls.enabled = true;

        //SETS WHERE THE ORBIT CONTROLS ORBIT AROUND
        controls.target = new THREE.Vector3(45 - 10.8, 30.55, -60);

        var savedVector = controls.object.getWorldDirection();
        console.log(savedVector);

        var currentDesk = new THREE.Object3D();
        var testArr = [];

        //dragControls = new THREE.DragControls(testArr, camera, renderer.domElement);

        /*dragControls.addEventListener('drag', function (event) {
            console.log('drag');
            console.log(event.object);
            controls.enabled = false;
            //event.object.position.y = 0;
        });

        dragControls.addEventListener('dragstart', function (event) {
            controls.enabled = false;
        });

        dragControls.addEventListener('dragend', function (event) {
            controls.enabled = true;
        });*/
        transformControls = new THREE.TransformControls(camera, renderer.domElement);
        transformControls.enabled = true;
        transformControls.size = 1;
        transformControls.addEventListener('change', render);
        scene.add(transformControls);

        transformControls.addEventListener('mouseDown', function () {
            controls.enabled = false;
        });
        transformControls.addEventListener('mouseUp', function () {
            controls.enabled = true;
        });

        window.addEventListener('resize', onWindowResize, false);
        transformControls.showY = !transformControls.showY;

        window.addEventListener('keydown', function (event) {

            switch (event.keyCode) {

                case 81: // Q
                    transformControls.setSpace(transformControls.space === "local" ? "world" : "local");
                    break;

                case 16: // Shift
                    transformControls.setTranslationSnap(100);
                    transformControls.setRotationSnap(THREE.MathUtils.degToRad(15));
                    transformControls.setScaleSnap(0.25);
                    break;

                case 87: // W
                    transformControls.setMode("translate");
                    break;

                case 69: // E
                    transformControls.setMode("rotate");
                    break;

                case 82: // R
                    transformControls.setMode("scale");
                    break;

                case 67: // C
                    const position = camera.position.clone();

                    camera = camera.isPerspectiveCamera ? cameraOrtho : cameraPersp;
                    camera.position.copy(position);

                    transformControls.object = camera;
                    transformControls.camera = camera;

                    camera.lookAt(controls.target.x, controls.target.y, controls.target.z);
                    onWindowResize();
                    break;

                case 86: // V
                    const randomFoV = Math.random() + 0.1;
                    const randomZoom = Math.random() + 0.1;

                    cameraPersp.fov = randomFoV * 160;
                    cameraOrtho.bottom = - randomFoV * 500;
                    cameraOrtho.top = randomFoV * 500;

                    cameraPersp.zoom = randomZoom * 5;
                    cameraOrtho.zoom = randomZoom * 5;
                    onWindowResize();
                    break;

                case 187:
                case 107: // +, =, num+
                    transformControls.setSize(transformControls.size + 0.1);
                    break;

                case 189:
                case 109: // -, _, num-
                    transformControls.setSize(Math.max(transformControls.size - 0.1, 0.1));
                    break;

                case 88: // X
                    transformControls.showX = !transformControls.showX;
                    break;

                case 89: // Y
                    transformControls.showY = !transformControls.showY;
                    break;

                case 90: // Z
                    transformControls.showZ = !transformControls.showZ;
                    break;

                case 32: // Spacebar
                    transformControls.enabled = !transformControls.enabled;
                    break;

            }

        });

        window.addEventListener('keyup', function (event) {

            switch (event.keyCode) {

                case 16: // Shift
                    transformControls.setTranslationSnap(null);
                    transformControls.setRotationSnap(null);
                    transformControls.setScaleSnap(null);
                    break;

            }

        });

        /*transformControls.addEventListener('change', function (event) {
            console.log('TRANSFORM');
            console.log(event.object);
            //controls.enabled = false;
            //event.object.position.y = 0;
        });

        transformControls.addEventListener('mouseDown', function (event) {
            controls.enabled = false;
        });

        transformControls.addEventListener('mouseUp', function (event) {
            controls.enabled = true;
        });*/

        //load desk
        loader.load('keyboards/60_Keyboard_1newnew.glb', function (gltf) {
            var theModel = gltf.scene;
            currentDesk = gltf.scene;
            theModel.traverse((o) => {
                if (o.isMesh) {
                    o.castShadow = true;
                    o.receiveShadow = true;
                }
            });
            currentDesk.position.set(29, 31.35, -50);
            console.log(gltf);
            transformControls.attach(gltf.scene.children[0]);
            console.log("CHILDREN");
            scene.add(gltf.scene.children[0]);
        }, undefined, function (error) {
            console.error(error);
        });

        console.log(transformControls.object);
        //var deskArr = [];
        /*var deskControls = new THREE.DragControls(deskArr, camera, renderer.domElement);
        deskControls.transformGroup = true;
        deskControls.addEventListener('drag', function (event) {
            console.log('drag');
            console.log(event.object);
            controls.enabled = false;
            //event.object.position.y = 0;
        });

        deskControls.addEventListener('dragstart', function (event) {
            controls.enabled = false;
        });

        deskControls.addEventListener('dragend', function (event) {
            controls.enabled = true;
        });*/

        loader.load('desks/standing_desk_1.glb', function (gltf) {
            var theModel = gltf.scene;
            currentDesk = gltf.scene;
            theModel.traverse((o) => {
                if (o.isMesh) {
                    o.castShadow = true;
                    o.receiveShadow = true;
                }
            });
            currentDesk.position.set(29, 31.35, -50);
            console.log(gltf);
            testArr.push(gltf.scene);
            transformControls.attach(gltf.scene.children[0]);
            scene.add(gltf.scene);
        }, undefined, function (error) {
            console.error(error);
        });

        //Loader for the room
        loader.load('rooms/room_2.glb', function (gltf) {
            var theModel = gltf.scene;
            theModel.traverse((o) => {
                if (o.isMesh) {
                    o.castShadow = true;
                    o.receiveShadow = true;
                }
            });
            scene.add(gltf.scene);
        }, undefined, function (error) {
            console.error(error);
        });


        window.addEventListener('resize', onWindowResize, false);

        function onWindowResize() {
            camera.aspect = rightSideContainer.clientWidth / rightSideContainer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(rightSideContainer.clientWidth, rightSideContainer.clientHeight);
        }
        function render() {
            renderer.render(scene, camera);
        }

        function animate() {
            requestAnimationFrame(animate);
            camera.updateProjectionMatrix();
            controls.update();
            renderer.render(scene, camera);
        }
        animate();




    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</body>

</html>